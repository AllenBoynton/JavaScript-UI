// Allen Boynton
// MIU 1506
// Utility Application
// June 25, 2015

// Create main window
var mainWindow = Ti.UI.createWindow ({
	backgroundColor: "black",
	title: 'Spiral Music Library'
});

navWindow = Ti.UI.iOS.createNavigationWindow ({
	window: mainWindow
});

// Create top page header
var header = Ti.UI.createLabel ({
	backgroundColor: 'white',
	text: 'Access Your Library',
	top: 0,
	height: 30,
	width: '100%',
	color: '#007aff',
	textAlign: 'center',
	font: {fontSize: 17, fontFamily:'LobsterTwo-Italic'}
});

// Variables to create toolbar
var register = Titanium.UI.createButton({
    title: 'Register',
    style: Titanium.UI.iPhone.SystemButtonStyle.DONE,
});

var top5 = Titanium.UI.createButton({
	title: 'TOP 5',
    style: Titanium.UI.iPhone.SystemButtonStyle.DONE,
});

var exit = Titanium.UI.createButton({
    title: '       Exit ',
    style: Titanium.UI.iPhone.SystemButtonStyle.DONE,
});

flexSpace = Titanium.UI.createButton({
    systemButton:Titanium.UI.iPhone.SystemButton.FLEXIBLE_SPACE
});

// Toolbar with 3 tabs
var toolbar = Titanium.UI.iOS.createToolbar({
    items:[register, flexSpace, top5, flexSpace, exit],
    bottom:0,
    borderTop:true,
    borderBottom:false
});

register.addEventListener('click', getRegistered);
		
// Username text field
var username = Ti.UI.createTextField ({
	borderStyle: Ti.UI.INPUT_BORDERSTYLE_ROUNDED,
	returnKeyType: Ti.UI.RETURNKEY_DEFAULT,
	keyboardType: Ti.UI.KEYBOARD_DEFAULF,
	hintText: 'Username',
	color: 'black',
	top: header.top + header.height + 60,
	height: 35,
	left: 70,
	right: 70
});

// Password text field
var password = Ti.UI.createTextField ({
	borderStyle: Ti.UI.INPUT_BORDERSTYLE_ROUNDED,
	returnKeyType: Ti.UI.RETURNKEY_DEFAULT,
	keyboardType: Ti.UI.KEYBOARD_DEFAULT,
	hintText: 'Password',
	color: 'black',
	top: username.top + username.height + 25,
	height: 35,
	left: 70,
	right: 70,
	passwordMask: true
});

// Sign In button
var loginButton = Ti.UI.createButton ({
	title: 'Login',
	backgroundColor: '#ef662f',
	color: 'white',
	font: {fontSize: 18, fontFamily:'LobsterTwo-BoldItalic'},
	borderRadius: 4,
	top: username.top + username.height + 140,
	left: 120,
	right: 120
});

// Forgot password
var forgot = Ti.UI.createButton ({
	title: 'Forget your password?',
	color: 'white',
	textAlign: 'center',
	top: password.top + password.height + 15,
	font: {fontSize: 16, fontFamily:'LobsterTwo-BoldItalic'}
});
	
// Verify login info
var getLoggedIn = function(){
	
	if (username.value !== textField2.value){
		alert ('Your username is incorrect');
	} else if (password.value !== textField3.value && textField4.value){
		alert ('Your password does not match');
	} else {
		alert ('Welcome ' + textField1 + ', enjoy your listening!');
	};
	
	loginButton.addEventListener('click', getSongs);
		getLoggedIn();
		
	var getPassword = function(){
		var forgotWindow = Ti.UI.createWindow ({
			backgroundColor: 'black',
			title: 'Password Recovery'
		});
		
		var emailField1 = Ti.UI.createTextField ({
			borderStyle: Ti.UI.INPUT_BORDERSTYLE_ROUNDED,
			returnKeyType: Ti.UI.RETURNKEY_DEFAULT,
			keyboardType: Ti.UI.KEYBOARD_DEFAULT,
			backgroundColor: 'white',
			borderRadius: 4,
			top: 60,
			height: 30,
			left: 110,
			right: 60
		});
		
		//Enter email
		var email = Ti.UI.createLabel ({
			text: 'Enter email',
			color: 'white',
			font: {fontSize: 18, fontFamily:'LobsterTwo-BoldItalic'},
			top: 62,
			left: 10
		});
		
		// Input hint text for email entry
		var inputHint1 = Ti.UI.createLabel ({
			text: 'Enter email to retrieve your password',
			color: 'white',
			font: {fontSize: 10},
			top: emailField1.top + emailField1.height + 4,
			left: 110
		});
		
		// Verify email
		var emailField2 = Ti.UI.createTextField ({
			borderStyle: Ti.UI.INPUT_BORDERSTYLE_ROUNDED,
			returnKeyType: Ti.UI.RETURNKEY_DEFAULT,
			keyboardType: Ti.UI.KEYBOARD_DEFAULT,
			backgroundColor: 'white',
			borderRadius: 4,
			top: emailField1.top + emailField1.height + 40,
			height: 30,
			left: 110,
			right: 60
		});
		
		//Text for emailField2
		var username2 = Ti.UI.createLabel ({
			text: 'Verify email',
			color: 'white',
			font: {fontSize: 18, fontFamily:'LobsterTwo-BoldItalic'},
			top: emailField1.top + emailField1.height + 40,
			left: 10
		});
		
		var checkRecovery = function(){
			
			if (emailField1.value !== emailField2.value){
				alert ('The emails you entered do not match');
			} else if (emailField1.value !== textField5.value){
				alert ('There is no record of that email being registered');
			} else {
				alert ('Your password will be sent to ' + emailField2 + '!');
			}
			
		};
		
		// Recover button
		var recoverButton = Ti.UI.createButton ({
			title: 'Recover Password',
			backgroundColor: '#ef662f',
			color: 'white',
			font: {fontSize: 18, fontFamily:'LobsterTwo-BoldItalic'},
			textAlign: 'center',
			borderRadius: 4,
			top: emailField2.top + emailField2.height + 60,
			height: 30,
			left: 110,
			right: 110
		}); 
		
		// Add image to page
		var image = Ti.UI.createImageView ({
			image: 'images/questionmark.jpg',
			height: 240,
			bottom: 50,
			width: '100%'
		});
		
		// Escape button
		var exit3 = Ti.UI.createButton({
			backgroundColor: '#dfdfdf',
	    	title: 'Exit',
	    	color: '#007aff',
	    	font: {fontSize: 20, fontWeight: 'bold'},
	    	width: '100%',
	    	height: 50,
	    	bottom:0,
	   		borderTop:true,
	    	borderBottom:false
		});
		
		// Remove window
		var removeWindow = function(){
			forgotWindow.close();
		};
		
		// Main secondary code			
		forgotWindow.add(emailField1, email, inputHint1, emailField2, username2, image, recoverButton, exit3);
		navWindow.openWindow(forgotWindow);
		forgot.addEventListener('click', getPassword);
		recoverButton.addEventListener('click', function(){ alert('Your password has been sent to your email \n Click "OK" to return to Login'); });	
		recoverButton.addEventListener('click', removeWindow);
		exit3.addEventListener('click', removeWindow);	
		
		// Function for registering
		var getRegistered = function(){	
			var registerWindow = Ti.UI.createWindow ({
				backgroundColor: 'black',
				title: 'Registration'
			});
			
			// Aesthetic header
			var header = Ti.UI.createLabel ({
				backgroundColor: 'white',
				text: 'Welcome to Spiral Records',
				top: 0,
				height: 30,
				width: '100%',
				color: '#007aff',
				textAlign: 'center',
				font: {fontSize: 17, fontFamily:'LobsterTwo-Italic'}
			});
			
			// Create field1
			var textField1 = Ti.UI.createTextField ({
				borderStyle: Ti.UI.INPUT_BORDERSTYLE_ROUNDED,
				top: header.top + header.height + 40,
				height: 30,
				left: 100,
				right: 120
			});
			
			//Text for field1
			var fullName = Ti.UI.createLabel ({
				text: '*Full Name ',
				color: 'white',
				font: {fontSize: 16, fontFamily:'LobsterTwo-BoldItalic'},
				top: header.top + header.height + 45,
				left: 10
			});
			
			// Input hint text for full name
			var inputHint1 = Ti.UI.createLabel ({
				text: 'Enter first and last name',
				color: 'white',
				font: {fontSize: 10},
				top: textField1.top + textField1.height + 2,
				left: 100
			});
			
			// Create field2
			var textField2 = Ti.UI.createTextField ({
				borderStyle: Ti.UI.INPUT_BORDERSTYLE_ROUNDED,
				top: textField5.top + textField5.height + 30,
				height: 30,
				left: 100,
				right: 100
			});
			
			//Text for field2
			var userName = Ti.UI.createLabel ({
				text: '*Username ',
				color: 'white',
				font: {fontSize: 16, fontFamily:'LobsterTwo-BoldItalic'},
				top: textField5.top + textField5.height + 35,
				left: 10
			});
			
			// Input hint text for username
			var inputHint2 = Ti.UI.createLabel ({
				text: 'Enter a username between 6 and 12 characters',
				color: 'white',
				font: {fontSize: 10},
				top: textField2.top + textField2.height + 2,
				left: 100
			});
			
			// Create field3
			var textField3 = Ti.UI.createTextField ({
				borderStyle: Ti.UI.INPUT_BORDERSTYLE_ROUNDED,
				top: textField2.top + textField2.height + 30,
				height: 30,
				left: 100,
				right: 100
			});
			
			//Text for field3
			var password1 = Ti.UI.createLabel ({
				text: '*Password ',
				color: 'white',
				font: {fontSize: 16, fontFamily:'LobsterTwo-BoldItalic'},
				top: textField2.top + textField2.height + 35,
				left: 10
			});
			
			// Input hint text for password
			var inputHint3 = Ti.UI.createLabel ({
				text: 'Enter a password between 6 and 12 characters',
				color: 'white',
				font: {fontSize: 10},
				top: textField3.top + textField3.height + 2,
				left: 100
			});
			
			// Create field4
			var textField4 = Ti.UI.createTextField ({
				borderStyle: Ti.UI.INPUT_BORDERSTYLE_ROUNDED,
				top: textField3.top + textField3.height + 30,
				height: 30,
				left: 100,
				right: 100
			});
			
			//Text for field4
			var password2 = Ti.UI.createLabel ({
				text: '*Password ',
				color: 'white',
				font: {fontSize: 16, fontFamily:'LobsterTwo-BoldItalic'},
				top: textField3.top + textField3.height + 35,
				left: 10
			});
			
			// Input hint text for password2
			var inputHint4 = Ti.UI.createLabel ({
				text: 'Verify password',
				color: 'white',
				font: {fontSize: 10},
				top: textField4.top + textField4.height + 2,
				left: 100
			});
			
			// Enter email
			var textField5 = Ti.UI.createTextField ({
				borderStyle: Ti.UI.INPUT_BORDERSTYLE_ROUNDED,
				top: textField1.top + textField1.height + 30,
				height: 30,
				left: 100,
				right: 120
			});
			
			//Text for field5
			var email = Ti.UI.createLabel ({
				text: '*Email ',
				color: 'white',
				font: {fontSize: 16, fontFamily:'LobsterTwo-BoldItalic'},
				top: textField1.top + textField1.height + 35,
				left: 10
			});
			
			// Input hint text for full name
			var inputHint5 = Ti.UI.createLabel ({
				text: 'Enter a valid email address',
				color: 'white',
				font: {fontSize: 10},
				top: textField5.top + textField5.height + 2,
				left: 100
			});
			
			// Sign In button
			var enterButton = Ti.UI.createButton ({
				title: 'Enter',
				backgroundColor: '#ef662f',
				color: 'white',
				font: {fontSize: 18, fontFamily:'LobsterTwo-BoldItalic'},
				borderRadius: 4,
				top: textField4.top + textField4.height + 50,
				left: 100,
				right: 160
			});
			
			// Verify all info is filled in and correctly
			var checkFields = function(){
				if (textField5.value.length + textField4.value.length + textField3.value.length + textField2.value.length + textField1.value.length === 0){
					alert ('Please enter all required fields.');
				} else if (textField4.value.length === 0){
					alert ('Please verify your password.');
				} else if (textField3.value.length === 0){
					alert ('Please enter a password.');
				} else if (textField2.value.length === 0){
					alert ('Please enter a valid username.');
				} else if (textField1.value.length === 0){
					alert ('Please enter your full name');
				} else if (textField5.value.length === 0){
					alert ('Please enter a valid email address');
				} else if (textField4.value.length !== textField3.value.length){
					alert ('Passwords entered do not match' + '\n' + 'Please enter again');
				} else {
					alert ('Congratulations ' + textField1.value + ' your username is ' + textField2.value + ', you are now registered!');
				};
			};
			
			// Entered registration info is verified
			enterButton.addEventListener('click', function(e){
				checkFields();
			});
			
			// Input hint text for required info
			var required = Ti.UI.createLabel ({
				text: '* Required Information',
				color: '#dfdfdf',
				font: {fontSize: 11, fontWeight: 'bold'},
				top: textField4.top + textField4.height + 92,
				left: 100
			});
			
			// Add image to page
			var image = Ti.UI.createImageView ({
				image: 'images/microphone.jpg',
				height: 240,
				bottom: 50,
				width: '100%'
			});
			
			// Escape button
			var exit2 = Ti.UI.createButton({
				backgroundColor: '#dfdfdf',
		    	title: 'Exit',
		    	color: '#007aff',
		    	font: {fontSize: 20, fontWeight: 'bold'},
		    	width: '100%',
		    	height: 50,
		    	bottom:0,
		    	borderTop:true,
		    	borderBottom:false
			});
			
			// Remove window
			var removeWindow = function(){
				registerWindow.close();
			};
					
			registerWindow.add(header, textField1, fullName, inputHint1, textField2, userName, inputHint2, textField3, password1, inputHint3, textField4, password2, inputHint4, textField5, email, inputHint5, image, enterButton, required, exit2);
			navWindow.openWindow(registerWindow);
			exit2.addEventListener('click', function(){ alert('Are you sure you want to log off?'); });
			exit2.addEventListener('click', removeWindow);
			enterButton.addEventListener('click', getSongs);
			
		};
		
	};
	
};

//Image view
var image = Ti.UI.createImageView ({
	image: 'images/mixer.jpg',
	height: 250,
	top: 310,
	width: '100%' 
});

// Load json data to bootstrap file
var loadFile = require('json');

// Main code for view function
mainWindow.add(header, toolbar, username, password, forgot, loginButton, image);
top5.addEventListener('click', function(){ alert('Please login to view your library.'); });
exit.addEventListener('click', function(){ alert('Are you sure you want to log off?'); });
navWindow.open();
